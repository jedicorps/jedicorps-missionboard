<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JEDI Corps Mission Board</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f0f8ff; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #4a90e2; color: white; }
    .impact { color: purple; font-weight: bold; }
    .grok-scout { background: #9370db; color: white; padding: 10px; margin: 10px 0; border-radius: 5px; }
    @media (max-width: 600px) { table { font-size: 12px; } }
  </style>
</head>
<body>
  <h1>JEDI Corps Mission Board ğŸ’œâš¡ï¸</h1>
  <p>Humanitarian Dashboard: Forex Factory for Philanthropy. Live data incoming...</p>
  <div id="user-status" style="text-align:center; margin:20px; color:#9370db; font-weight:bold;"></div>
  <button id="grok-btn" class="grok-btn" onclick="rainmakerQuery()">Grok Scout (AI Assist) â€“ Verify X Login to Activate</button>

  <table id="mission-table">
    <thead>
      <tr>
        <th>Date/Time</th><th>Impact</th><th>Event/Report</th><th>Actual</th><th>Target/Forecast</th><th>Previous</th><th>Grokipedia</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>26 Nov 2025 15:30</td><td class="impact">ğŸ’œğŸ’œğŸ’œğŸ’œ</td><td>Hurricane Otis â€“ Guerrero 30-day AAR</td><td>1.8M served</td><td>2.2M pledged</td><td>1.4M (Oct)</td><td><a href="#">[Stub]</a></td></tr>
      <tr><td>28 Nov 2025</td><td class="impact">ğŸ’œğŸ’œğŸ’œ</td><td>Org XYZ 2024 Form 990 Deadline</td><td>â€”</td><td>On-time</td><td>Late 42d</td><td><a href="#">[Stub]</a></td></tr>
      <tr><td>02 Dec 2025 09:00</td><td class="impact">ğŸ’œğŸ’œğŸ’œğŸ’œğŸ’œ</td><td>Philippines Typhoon Rai â€“ Year-2 Audit</td><td>$41M spent</td><td>$38M budgeted</td><td>$22M (Y1)</td><td><a href="#">[Stub]</a></td></tr>
      <tr><td>05 Dec 2025</td><td class="impact">ğŸ’œğŸ’œ</td><td>TÃ¼rkiye-Syria EQ Appeal Close-out</td><td>68% funded</td><td>100%</td><td>72% (prior)</td><td><a href="#">[Stub]</a></td></tr>
    </tbody>
  </table>

  <p><em>Filters: Track (Pink/White/Purple) | Country | Impact â‰¥ | Transparency Score</em></p>
  <div style="text-align:center; margin:40px; color:#9370db; font-size:18px;">
    <strong>Support the Mission:</strong><br><br>
    <a href="https://cash.app/$JEDICorps" style="color:#00ff9d; font-size:24px;">ğŸ’µ $JEDICorps (Cash App)</a><br>
    <code style="background:#111; padding:8px; border-radius:8px; font-size:14px; word-break:break-all;">
      â‚¿ bc1qpyxl87a3dsk7c3aff9xlxyj2u24wyt7hwtc5ax
    </code><br><br>
    Every dollar logged live <a href="https://x.com/LighthouseAid" target="_blank">here</a>
  </div>

  <script>
    function toggleGrokScout() {
      const cookies = document.cookie;
      const isLoggedInX = cookies.includes('auth_token') || cookies.includes('twid');
      const status = document.getElementById('user-status');
      const btn = document.getElementById('grok-btn');
      
      console.log('All cookies:', cookies);
      console.log('X login detected?', isLoggedInX);
      
      if (isLoggedInX) {
        status.innerHTML = 'X Verified â€“ Grok Scout Active!';
        btn.innerHTML = 'Rainmaker Ready: "10k MREs for Acapulco?"';
        btn.style.background = '#4a90e2';
      } else {
        status.innerHTML = 'X Login Not Detected â€“ Open x.com, log in, then refresh.';
        btn.style.background = '#9370db';
        btn.onclick = () => { window.open('https://x.com/login', '_blank'); alert('Logged in? Refresh this page.'); };
      }
    }
    function rainmakerQuery() {
      const query = prompt('Rainmaker query (e.g. "10k MREs for Acapulco")');
      if (query) {
        alert(`Mission queued: "${query}"\nâ†’ Logged to @LighthouseAid ledger\nâ†’ Funds route via $JEDICorps when received`);
        // Later: auto-tweet stub when we have API
      }
    }
async function loadReliefWebData(countryCode = 'MX') {
  const iso3Map = { "MX":"MEX","PH":"PHL","TR":"TUR","SY":"SYR","UA":"UKR","AF":"AFG","US":"USA","GLOBAL":"GLOBAL" };
  const iso3 = iso3Map[countryCode] || countryCode;

  try {
    const res = await fetch(`https://api.reliefweb.int/v1/reports?appname=jedicorps&limit=10&sort=date:desc&preset=latest&filter[operator]=AND&filter[conditions][0][field]=country.iso3&filter[conditions][0][value]=${iso3}`, {
      headers: {
        'User-Agent': 'JEDI Corps Mission Board v1.0 (+https://jedicorps.app)'
      }
    });
    const json = await res.json();

    const tbody = document.querySelector('#mission-table tbody');
    tbody.innerHTML = '';

    if (!json.data || json.data.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7">No reports right now â€“ try another country later</td></tr>';
      return;
    }

    json.data.forEach(item => {
      const f = item.fields;
      const date = f.date?.created?.slice(0,10) || 'N/A';
      const hearts = 'Heart'.repeat(Math.min(5, (f.theme?.length || 0) + (f.format?.length > 1 ? 2 : 1)));
      const title = f.title || 'Untitled report';

      tbody.innerHTML += `<tr>
        <td>${date}</td>
        <td class="impact">${hearts}</td>
        <td>${title}</td>
        <td>Ongoing</td>
        <td>â€”</td>
        <td>â€”</td>
        <td><a href="${item.href}" target="_blank">View</a></td>
      </tr>`;
    });

  } catch (e) {
    console.error('ReliefWeb blocked:', e);
    document.querySelector('#mission-table tbody').innerHTML = '<tr><td colspan="7">Live data offline â€“ showing samples</td></tr>';
  }
}

window.onload = () => {
  toggleGrokScout();
  loadReliefWebData('MX');
};
</script>
</body>
</html>
